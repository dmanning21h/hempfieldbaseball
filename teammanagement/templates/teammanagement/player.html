{% extends 'base.html' %}
{% load static %}
{% load teammanagement_tags %}
{% load playerprogress_tags %}

{% block title %}{{ player.full_name }}{% endblock %}
{% block description %}<meta name="description" content="{{ player.full_name }} extended roster details and player progress.">{% endblock %}

{% block stylesheet %}
	<link rel="stylesheet" href="{% static 'css/teammanagement.css' %}">
{% endblock %}

{% block content %}
	<div class="container pt-2">
		<hr>
	</div>

	<div id="playerInfo" class="container pt-2">
		<div class="row">
			<div class="col-md-3 text-center mb-3 pl-md-4 pl-lg-5">
				{% if roster_info.roster_photo %}
					<img src="{{ roster_info.roster_photo.url }}" width="175px" class="rounded border border-dark shadow-lg" alt="{{ player.full_name }} roster photo">
				{% endif %}
			</div>

			<div class="col-md-7 px-4 px-md-4 ms-md-4 ms-lg-2">
				<h1>
					<span class="player-number px-2 pb-1" style="display: inline-block; border-radius: 5px;">{{ roster_info.number }}</span>
					<span class="text-shadow-md" style="font-size: smaller;">{{ player.full_name|upper }}</span>
				</h1>

				<hr>

				<div class="row">
					<div class="col-md-6">
						<p>
							<b>CLASS:</b> {{ player.graduation_year }}
						</p>
						<hr>
						<p>
							<b>POSITION:</b> {{ roster_info.position }}
						</p>
						<hr>
						<p>
							<b>BATS/THROWS:</b> {{ player.bats }}/{{ player.throws }}
						</p>
						<hr>
					</div>
					<div class="col-md-6">
						<p>
							<b>HEIGHT:</b> {{ roster_info.height }}
						</p>
						<hr>
							<p>
								<b>WEIGHT:</b> {{ roster_info.weight }} lbs
							</p>
							<hr>
					</div>
				</div>
			</div>

		</div>
	</div>
	<br>

	<div id="playerProgress">
		<div id="progressHeader" class="text-center text-shadow-md" style="display: none">
			<h3 class="">Player Progress</h3>
		</div>
		<div id="accordion" class="container"></div>
	</div>

{% endblock %}



{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.1"></script>
<script src="{% static 'js/teammanagement.js' %}"></script>

<script>
	generateAccordionTabs();

	function generateAccordionTabs() {
		var playerId = "{{ player.player_id }}";

		var bodyWeightsRequest = fetchBodyWeightDataAsync(playerId);
		var liftsRequest = fetchLiftingDataAsync(playerId);
		var velocitiesRequest = fetchVelocityDataAsync(playerId);
		var timesRequest = fetchTimeDataAsync(playerId);

		// Fetch All Data async and await together
		$.when(bodyWeightsRequest).done(function(bodyWeightsResponse) {

				generateBodyWeightTab(playerId, bodyWeightsResponse);

				$.when(liftsRequest).done(function (liftsResponse) {
					generateLiftingTab(playerId, liftsResponse);

					$.when(velocitiesRequest).done(function (velocitiesResponse) {
						generateVelocityTab(playerId, velocitiesResponse);

						$.when(timesRequest).done(function (timesResponse) {
							generateTimesTab(playerId, timesResponse);

						});
					});
				});
			});
	}

	function fetchBodyWeightDataAsync(playerId) {
		url = "{% url 'playerprogress:get-player-body-weights-with-dates' %}";
		return fetchDataWithDatesAsync(url, playerId);
	}

	function fetchLiftingDataAsync(playerId) {
		url = "{% url 'playerprogress:get-player-lifts-with-dates' %}";
		return fetchDataWithDatesAsync(url, playerId);
	}

	function fetchVelocityDataAsync(playerId) {
		url = "{% url 'playerprogress:get-player-velocities-with-dates' %}";
		return fetchDataWithDatesAsync(url, playerId);
	}

	function fetchTimeDataAsync(playerId) {
		url = "{% url 'playerprogress:get-player-times-with-dates' %}";
		return fetchDataWithDatesAsync(url, playerId);
	}	
</script>
{% endblock %}